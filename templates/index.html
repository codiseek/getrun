<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GETRUN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        let currentIndex = 0; // Текущий индекс, который определяет, сколько блоков показывать
        const filesPerPage = 5; // Количество файлов для загрузки за раз
        let allFiles = {{ files | tojson }}; // Получаем все файлы через Jinja (список всех файлов)

        // Функция для фильтрации файлов по описанию
        function filterFiles(query) {
            // Фильтруем файлы по описанию, делая поиск нечувствительным к регистру
            return allFiles.filter(file => file.description.toLowerCase().includes(query.toLowerCase()));
        }

        // Функция для загрузки файлов на страницу
        function loadMoreFiles() {
            const container = document.getElementById('file-container');
            const searchQuery = document.getElementById('search-input').value; // Получаем значение из поля поиска
            const filteredFiles = filterFiles(searchQuery); // Получаем отфильтрованные файлы
            const nextFiles = filteredFiles.slice(currentIndex, currentIndex + filesPerPage); // Загружаем очередную порцию

            nextFiles.forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.classList.add('file-box', 'bg-white', 'p-6', 'rounded-lg', 'shadow-lg', 'hover:shadow-xl', 'transition-all', 'duration-300');

                const description = document.createElement('p');
                description.classList.add('text-lg', 'font-semibold', 'text-gray-700', 'mb-3');
                description.textContent = file.description;

                const imageDiv = document.createElement('div');
                imageDiv.classList.add('mb-4');
                const image = document.createElement('img');
                image.classList.add('rounded-lg', 'w-full');
                image.src = "/static/previews/" + file.preview;
                image.alt = "Preview";

                const downloadLink = document.createElement('a');
                downloadLink.classList.add('download-btn', 'inline-block', 'bg-blue-500', 'text-white', 'py-2', 'px-4', 'rounded-lg', 'hover:bg-blue-600', 'transition-all');
                downloadLink.href = "/uploads/" + file.name;
                downloadLink.download = file.name;
                downloadLink.textContent = 'Скачать';

                fileDiv.appendChild(description);
                fileDiv.appendChild(imageDiv);
                imageDiv.appendChild(image);
                fileDiv.appendChild(downloadLink);

                container.appendChild(fileDiv);
            });

            currentIndex += filesPerPage; // Обновляем текущий индекс
            if (currentIndex >= filteredFiles.length) {
                document.getElementById('load-more-btn').style.display = 'none'; // Скрываем кнопку, если больше нет файлов
            }
        }

        // Функция для обработки события поиска
        function searchFiles() {
            currentIndex = 0; // Сбрасываем индекс, чтобы начать с первой страницы при новом поиске
            const container = document.getElementById('file-container');
            container.innerHTML = ''; // Очищаем контейнер от предыдущих результатов
            loadMoreFiles(); // Загружаем файлы, соответствующие поисковому запросу
        }

        // Загружаем первые блоки при загрузке страницы
        window.onload = function() {
            loadMoreFiles();
        };
    </script>
</head>
<body class="bg-white text-gray-800 font-sans">
    <h1 class="text-4xl text-center py-10 font-semibold">
        <a href="{{ url_for('index') }}">
            <img src="static/logo.svg" class="max-w-[250px] mx-auto" />
        </a>
        
        
    </h1>

<!-- Поле поиска -->
<div class="container mx-auto px-4 mb-6 text-center">
    <div class="relative w-full sm:w-1/2 lg:w-1/3 mx-auto">
        <input id="search-input" type="text" placeholder="Поиск по описанию" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-16" />
        <button onclick="searchFiles()" class="absolute right-1 top-1/2 transform -translate-y-1/2 bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600 transition-all">
            Найти
        </button>
    </div>
</div>




    <div class="container mx-auto px-4">
        <div id="file-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <!-- Кнопка для загрузки дополнительных файлов -->
        <div class="text-center mt-8">
            <button id="load-more-btn" onclick="loadMoreFiles()" class="bg-blue-500 text-white py-2 px-6 rounded-lg hover:bg-blue-600 transition-all mb-6">
                Загрузить еще
            </button>
        </div>
    </div>
</body>
</html>
